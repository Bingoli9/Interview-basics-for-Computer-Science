### mysql锁（九）innodb下的记录锁，间隙锁，next-key锁

### 行锁

记录锁，对表中的记录加锁，叫做记录锁，简称行锁。

### 间隙锁

编程的思想源于生活，生活中的例子能帮助我们更好的理解一些编程中的思想。
 生活中排队的场景，小明，小红，小花三个人依次站成一排，此时，如何让新来的小刚不能站在小红旁边，这时候只要将小红和她前面的小明之间的空隙封锁，将小红和她后面的小花之间的空隙封锁，那么小刚就不能站到小红的旁边。
 这里的小红，小明，小花，小刚就是数据库的一条条记录。
 他们之间的空隙也就是间隙，而封锁他们之间距离的锁，叫做间隙锁。

间隙锁的目的是为了防止幻读，其主要通过两个方面实现这个目的

innodb自动使用间隙锁的条件：

1. 必须在RR级别下 
2. 检索条件必须有索引（没有索引的话，mysql会全表扫描，那样会锁定整张表所有的记录，包括不存在的记录，此时其他事务不能修改不能删除不能添加）

### next-key锁

next-key锁其实包含了记录锁和间隙锁，即锁定一个范围，并且锁定记录本身，InnoDB默认加锁方式是next-key 锁。

select * from news where number=4 for update ; next-key锁锁定的范围为间隙锁+记录锁，即区间（2，4），（4，5）加间隙锁，同时number=4的记录加记录锁。
